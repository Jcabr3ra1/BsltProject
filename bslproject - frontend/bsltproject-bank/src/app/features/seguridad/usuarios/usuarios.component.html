<div class="module-container">
  <div class="module-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="module-icon">people</mat-icon>
        <h1 class="module-title">Gestión de Usuarios</h1>
      </div>
      <div class="actions-section">
        <button mat-raised-button color="primary" class="add-button">
          <mat-icon>add</mat-icon>
          Nuevo Usuario
        </button>
      </div>
    </div>
    <p class="module-description">
      Administra los usuarios del sistema, asigna roles y estados, y gestiona sus permisos.
    </p>
  </div>

  <!-- Filtros y búsqueda -->
  <div class="filters-container">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar usuario</mat-label>
      <input matInput placeholder="Nombre, email o cuenta">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
    
    <div class="filter-actions">
      <mat-form-field appearance="outline">
        <mat-label>Filtrar por rol</mat-label>
        <mat-select>
          <mat-option [value]="''">Todos</mat-option>
          <mat-option *ngFor="let rol of roles" [value]="rol.id">
            {{ rol.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Filtrar por estado</mat-label>
        <mat-select>
          <mat-option [value]="''">Todos</mat-option>
          <mat-option *ngFor="let estado of estados" [value]="estado.id">
            {{ estado.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Mensaje de error -->
  <p class="error-message" *ngIf="errorMessage">{{ errorMessage }}</p>

  <!-- Tabla de usuarios -->
  <div class="table-container mat-elevation-z2">
    <table mat-table [dataSource]="usuarios" class="users-table">
      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let user" class="id-cell"> 
          <span class="id-text">{{ user.id }}</span>
        </td>
      </ng-container>

      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Nombre </th>
        <td mat-cell *matCellDef="let user" class="editable-cell">
          <input matInput [(ngModel)]="user.nombre" (blur)="actualizarUsuario(user)" />
        </td>
      </ng-container>

      <!-- Email -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef> Email </th>
        <td mat-cell *matCellDef="let user" class="editable-cell">
          <input matInput [(ngModel)]="user.email" (blur)="actualizarUsuario(user)" />
        </td>
      </ng-container>

      <!-- Cuenta -->
      <ng-container matColumnDef="cuenta">
        <th mat-header-cell *matHeaderCellDef> Cuenta </th>
        <td mat-cell *matCellDef="let user">
          <span class="cuenta-badge" *ngIf="user.cuentaNumero">{{ user.cuentaNumero }}</span>
          <span class="sin-cuenta" *ngIf="!user.cuentaNumero">Sin cuenta</span>
        </td>
      </ng-container>

      <!-- Rol -->
      <ng-container matColumnDef="rol">
        <th mat-header-cell *matHeaderCellDef> Rol </th>
        <td mat-cell *matCellDef="let user">
          <mat-select [(ngModel)]="user.rol" (selectionChange)="asignarRol(user.id, $event.value)" class="table-select">
            <mat-option *ngFor="let rol of roles" [value]="rol.id">
              {{ rol.nombre }}
            </mat-option>
          </mat-select>
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let user">
          <mat-select [(ngModel)]="user.estado" (selectionChange)="asignarEstado(user.id, $event.value)" class="table-select">
            <mat-option *ngFor="let estado of estados" [value]="estado.id">
              <span class="estado-activo" *ngIf="estado.nombre === 'ACTIVO'">{{ estado.nombre }}</span>
              <span class="estado-inactivo" *ngIf="estado.nombre !== 'ACTIVO'">{{ estado.nombre }}</span>
            </mat-option>
          </mat-select>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let user">
          <div class="action-buttons">
            <button mat-icon-button color="primary" matTooltip="Ver detalles">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button color="warn" matTooltip="Eliminar usuario" (click)="eliminarUsuario(user.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['id', 'nombre', 'email', 'cuenta', 'rol', 'estado', 'acciones']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id', 'nombre', 'email', 'cuenta', 'rol', 'estado', 'acciones'];" class="user-row"></tr>
    </table>
  </div>

  <!-- Paginación -->
  <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>
</div>
