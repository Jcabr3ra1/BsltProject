<div class="usuario-dialog-container">
  <h2 mat-dialog-title>{{titulo}}</h2>
  
  <div *ngIf="loading" class="loading-overlay">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Procesando...</p>
  </div>
  
  <form [formGroup]="usuarioForm" (ngSubmit)="onSubmit()">
    <div mat-dialog-content>
      <!-- Campos ocultos -->
      <input type="hidden" formControlName="id">
      
      <!-- Nombre y Apellido -->
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" placeholder="Ingrese el nombre">
          <mat-error *ngIf="usuarioForm.get('nombre')?.invalid">{{getErrorMessage('nombre')}}</mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Apellido</mat-label>
          <input matInput formControlName="apellido" placeholder="Ingrese el apellido">
          <mat-error *ngIf="usuarioForm.get('apellido')?.invalid">{{getErrorMessage('apellido')}}</mat-error>
        </mat-form-field>
      </div>
      
      <!-- Email -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" placeholder="ejemplo@correo.com" type="email">
        <mat-icon matSuffix>email</mat-icon>
        <mat-error *ngIf="usuarioForm.get('email')?.invalid">{{getErrorMessage('email')}}</mat-error>
      </mat-form-field>
      
      <!-- Contraseña (solo para crear o si se quiere cambiar) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{modo === 'crear' ? 'Contraseña' : 'Nueva Contraseña (opcional)'}}</mat-label>
        <input matInput formControlName="password" type="password" placeholder="Mínimo 6 caracteres">
        <mat-icon matSuffix>lock</mat-icon>
        <mat-error *ngIf="usuarioForm.get('password')?.invalid">{{getErrorMessage('password')}}</mat-error>
        <mat-hint *ngIf="modo === 'editar'">Dejar en blanco para mantener la contraseña actual</mat-hint>
      </mat-form-field>
      
      <!-- Rol -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Rol</mat-label>
        <mat-select formControlName="rol">
          <mat-option *ngFor="let rol of roles" [value]="rol.id">
            {{rol.name}}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="usuarioForm.get('rol')?.invalid">{{getErrorMessage('rol')}}</mat-error>
      </mat-form-field>
      
      <!-- Estado -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Estado</mat-label>
        <mat-select formControlName="estado">
          <mat-option *ngFor="let estado of estados" [value]="estado.id">
            {{estado.name}}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="usuarioForm.get('estado')?.invalid">{{getErrorMessage('estado')}}</mat-error>
      </mat-form-field>
    </div>
    
    <div mat-dialog-actions align="end">
      <button mat-button type="button" (click)="onCancel()" [disabled]="loading">Cancelar</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="loading">
        {{modo === 'crear' ? 'Crear' : 'Guardar'}}
      </button>
    </div>
  </form>
</div>
