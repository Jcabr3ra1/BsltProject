<h2 mat-dialog-title>
    <mat-icon class="title-icon">swap_horiz</mat-icon>
    Registrar transacción
</h2>

<form [formGroup]="form" (ngSubmit)="guardar()" class="form-container">

    <!-- Tipo de transacción -->
    <div class="transaction-type-container">
        <label class="input-label">Tipo de transacción*</label>
        <div class="icon-buttons-container">
            <button type="button" mat-icon-button *ngFor="let tipo of data.tiposTransaccion"
                [class.selected]="form.get('id_tipo_transaccion')?.value === (tipo.id || tipo._id)"
                (click)="seleccionarTipoTransaccion(tipo.id || tipo._id)">
                <div class="transaction-icon" [attr.data-type]="tipo.descripcion">
                    <mat-icon *ngIf="tipo.descripcion.toLowerCase().includes('consignación')">arrow_downward</mat-icon>
                    <mat-icon *ngIf="tipo.descripcion.toLowerCase().includes('retiro')">arrow_upward</mat-icon>
                    <mat-icon *ngIf="tipo.descripcion.toLowerCase().includes('transferencia')">sync_alt</mat-icon>
                </div>
                <span class="icon-label">{{tipo.descripcion}}</span>
            </button>
        </div>
    </div>

    <!-- Tipo de movimiento -->
    <div class="movement-type-container">
        <label class="input-label">Tipo de movimiento*</label>
        <div class="icon-buttons-container">
            <button type="button" mat-icon-button *ngFor="let tipo of data.tiposMovimiento"
                [class.selected]="form.get('id_tipo_movimiento')?.value === (tipo.id || tipo._id)"
                (click)="seleccionarTipoMovimiento(tipo.id || tipo._id)">
                <div class="movement-icon" [attr.data-type]="tipo.codigo_origen + '-' + tipo.codigo_destino">
                    <span class="movement-icon-text" [innerHTML]="obtenerIconoMovimiento(tipo)"></span>
                </div>
                <span class="icon-label">{{obtenerDescripcionCorta(tipo)}}</span>
            </button>
        </div>
    </div>

    <!-- Campos de formulario en grid -->
    <div class="form-fields-container">
        <!-- Cuenta origen -->
        <mat-form-field *ngIf="mostrarCampo('cuenta_origen')" class="form-field-transition" appearance="outline">
            <mat-label>Cuenta origen</mat-label>
            <mat-icon matPrefix class="field-icon">account_balance</mat-icon>
            <mat-select formControlName="id_cuenta_origen" required>
                <mat-option *ngFor="let cuenta of data.cuentas" [value]="cuenta.id || cuenta._id">
                    {{ cuenta.numero_cuenta }}
                </mat-option>
            </mat-select>
            <mat-hint>Selecciona la cuenta de origen</mat-hint>
        </mat-form-field>

        <!-- Cuenta destino -->
        <mat-form-field *ngIf="mostrarCampo('cuenta_destino')" class="form-field-transition" appearance="outline">
            <mat-label>Cuenta destino</mat-label>
            <mat-icon matPrefix class="field-icon">arrow_forward</mat-icon>
            <mat-select formControlName="id_cuenta_destino" required>
                <mat-option *ngFor="let cuenta of data.cuentas" [value]="cuenta.id || cuenta._id">
                    {{ cuenta.numero_cuenta }}
                </mat-option>
            </mat-select>
            <mat-hint>Selecciona la cuenta destino</mat-hint>
        </mat-form-field>

        <!-- Bolsillo origen -->
        <mat-form-field *ngIf="mostrarCampo('bolsillo_origen')" class="form-field-transition" appearance="outline">
            <mat-label>Bolsillo origen</mat-label>
            <mat-icon matPrefix class="field-icon">folder</mat-icon>
            <mat-select formControlName="id_bolsillo_origen" required>
                <mat-option *ngFor="let b of data.bolsillos" [value]="b.id || b._id">
                    {{ b.nombre }}
                </mat-option>
            </mat-select>
            <mat-hint>Selecciona el bolsillo de origen</mat-hint>
        </mat-form-field>

        <!-- Bolsillo destino -->
        <mat-form-field *ngIf="mostrarCampo('bolsillo_destino')" class="form-field-transition" appearance="outline">
            <mat-label>Bolsillo destino</mat-label>
            <mat-icon matPrefix class="field-icon">folder_shared</mat-icon>
            <mat-select formControlName="id_bolsillo_destino" required>
                <mat-option *ngFor="let b of data.bolsillos" [value]="b.id || b._id">
                    {{ b.nombre }}
                </mat-option>
            </mat-select>
            <mat-hint>Selecciona el bolsillo destino</mat-hint>
        </mat-form-field>
    </div>

    <!-- Monto y descripción -->
    <!-- Monto y descripción en la misma fila -->
    <div class="form-fields-container">
        <mat-form-field class="animated-field" appearance="outline">
            <mat-label>Monto</mat-label>
            <span matPrefix class="currency-prefix">$</span>
            <input matInput type="number" formControlName="monto" placeholder="Ej: 50000" required />
            <mat-hint>Ingresa el monto</mat-hint>
        </mat-form-field>

        <mat-form-field class="animated-field" appearance="outline">
            <mat-label>Descripción</mat-label>
            <mat-icon matPrefix class="field-icon">description</mat-icon>
            <input matInput formControlName="descripcion" placeholder="Ej: Pago mensual" required />
            <mat-hint>Breve descripción</mat-hint>
        </mat-form-field>
    </div>

    <!-- Acciones -->
    <div class="actions">
        <button mat-button type="button" (click)="cancelar()" matTooltip="Cancelar y volver">
            <mat-icon>close</mat-icon> Cancelar
        </button>
        <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid || !form.dirty"
            matTooltip="Guardar transacción">
            <mat-icon>save</mat-icon> Guardar
        </button>
    </div>
</form>